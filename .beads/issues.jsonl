{"id":"noface-0vv","title":"Fix GitHub issue sync shell quoting errors","description":"The createGitHubIssue function in github.zig:305 builds a shell command with:\n```zig\n\"gh issue create --title \\\"{s}\\\" --label \\\"{s}\\\" --body \\\"$(cat \u003c\u003c'BEADS_EOF'\\n{s}\\nBEADS_EOF\\n)\\\"\"\n```\n\nThis causes shell parsing errors when issue titles or bodies contain special characters:\n```\n/bin/sh: -c: line 15: unexpected EOF while looking for matching \\`'\n/bin/sh: -c: line 26: syntax error: unexpected end of file\n```\n\nFailing issues include: noface-bw7, noface-3m7, noface-st2, noface-4h2, noface-zdk\n\nRoot causes:\n- Unescaped double quotes in title break the double-quoted string\n- Body content containing BEADS_EOF on its own line terminates heredoc early\n- Body containing backticks or $() causing expansion issues\n\nFix options:\n1. Use --body-file with a temp file instead of inline body\n2. Properly escape shell metacharacters before interpolation\n3. Use gh api directly with JSON payload instead of shell command","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T14:17:58.709372-08:00","updated_at":"2025-12-10T14:51:57.590479-08:00","closed_at":"2025-12-10T14:51:57.590479-08:00"}
{"id":"noface-0w3","title":"Orchestrator-managed review workflow with session resume","description":"Currently workers manually invoke `codex review --uncommitted` as a subprocess inside their Claude session (worker_pool.zig:385). This has several problems:\n\n## Current Problems\n\n1. **Nested processes**: Codex runs as subprocess of Claude subprocess - hard to monitor/manage\n2. **No orchestrator visibility**: Orchestrator doesn't know when workers are in review phase\n3. **Resource waste**: Claude session stays active during review (burning context/memory)\n4. **No session resume**: Workers don't use Claude's `--resume` capability - each restart rebuilds context\n5. **Review results lost**: Codex output goes to Claude's stdin, not captured for debugging/tracing\n\n## Proposed Architecture\n\n### New Signal\nWorker outputs `READY_FOR_REVIEW` when implementation is complete and ready for review.\n\n### Orchestrator Flow\n1. Detect `READY_FOR_REVIEW` signal (similar to `BLOCKED_BY_FILE` detection)\n2. Extract Claude's session_id from stream-json output\n3. Gracefully terminate worker process (or send pause signal)\n4. Store worker state: `{ issue_id, claude_session_id, status: awaiting_review }`\n5. Spawn Codex reviewer: `codex review --uncommitted`\n6. Capture review output\n7. Store review in beads: `bd comment \u003cissue_id\u003e \"Review feedback: ...\"`\n8. Resume worker: `claude --resume \u003csession_id\u003e -p \"Review feedback: \u003ccontent\u003e\"`\n\n### Benefits\n- **Orchestrator control**: Can limit concurrent reviews, prioritize by issue priority\n- **Resource efficiency**: Claude sessions paused during review\n- **Traceability**: Review feedback stored in beads issue history\n- **Session continuity**: Workers resume with full context via `--resume`\n- **Observability**: Orchestrator logs show review phase clearly\n\n## Implementation Notes\n\n1. Claude's stream-json includes `session_id` in output - need to extract and store\n2. May need new WorkerState: `.awaiting_review`\n3. Consider: should review failures allow worker retry, or escalate to human?\n4. The `--session-id \u003cuuid\u003e` flag can pre-specify session ID for easier tracking\n\n## Files to Modify\n\n- `src/worker_pool.zig`: Add READY_FOR_REVIEW detection, session extraction, review spawning\n- `src/state.zig`: Add `awaiting_review` status, store claude_session_id per worker\n- `src/streaming.zig`: Extract session_id from Claude's output\n- Worker prompt: Replace manual codex call with READY_FOR_REVIEW signal","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T14:35:45.302824-08:00","updated_at":"2025-12-10T14:35:45.302824-08:00","comments":[{"id":32,"issue_id":"noface-0w3","author":"femtomc","text":"Design decision: Review results stored in beads, not injected directly\n\nPer discussion, prioritize saving state to readable files (beads issues) over complex in-memory state management.\n\n## Revised Flow\n\n1. Worker signals `READY_FOR_REVIEW`\n2. Orchestrator terminates worker, saves `claude_session_id`\n3. Orchestrator runs `codex review --uncommitted`\n4. Review output stored: `bd comment \u003cissue_id\u003e \"## Review Feedback\\n\u003coutput\u003e\"`\n5. Resume worker: `claude --resume \u003csession_id\u003e -p \"Review feedback has been added to the issue. Run: bd comments \u003cissue_id\u003e\"`\n6. Worker reads feedback from beads, addresses it\n\n## Benefits of file-based state\n\n- **Debuggable**: Can inspect `bd comments \u003cissue\u003e` to see review history\n- **Recoverable**: If orchestrator crashes, review feedback persists in beads\n- **Transparent**: Human can see exactly what feedback worker received\n- **Auditable**: Full history of review cycles preserved\n- **Simple**: No complex in-memory state serialization needed\n\n## Implementation simplification\n\nThe orchestrator only needs to track:\n- `claude_session_id`: For resuming (could even store this in beads issue metadata)\n- `status: awaiting_review`: Simple enum state\n\nAll review content lives in beads - the source of truth.","created_at":"2025-12-10T22:36:50Z"},{"id":33,"issue_id":"noface-0w3","author":"femtomc","text":"Issue: Review scope with parallel workers\n\n`codex review --uncommitted` reviews ALL uncommitted changes, but with parallel workers we need to scope review to only the requesting worker's files.\n\n## Options\n\n### 1. Pipe specific diff to codex\n```bash\ngit diff -- src/foo.zig src/bar.zig | codex review -\n```\nUse manifest's `primary_files` to know which files the worker owns.\n\n### 2. Temporary staging\n```bash\ngit stash --keep-index  # stash unstaged\ngit add \u003cworker_files\u003e  # stage only worker's files\ncodex review --uncommitted\ngit reset HEAD          # unstage\ngit stash pop           # restore others' changes\n```\nRisky with parallel git operations.\n\n### 3. Worker-specific branch (cleaner)\nEach worker works on a branch: `noface/\u003cissue_id\u003e`\n```bash\ncodex review --base main  # reviews only that branch's changes\n```\nNatural isolation, but requires branch management.\n\n### 4. Pass files via prompt\n```bash\ncodex review --uncommitted \"Only review changes in: src/foo.zig, src/bar.zig\"\n```\nRelies on codex respecting the instruction.\n\n## Recommendation\n\nOption 3 (worker-specific branches) is cleanest:\n- Natural git isolation\n- `--base main` scopes review correctly  \n- Merge conflicts handled explicitly\n- Each worker's changes are traceable\n\nThis aligns with the manifest system - each issue/worker owns specific files on their branch.","created_at":"2025-12-10T22:37:54Z"},{"id":34,"issue_id":"noface-0w3","author":"femtomc","text":"Correction: Workers share single worktree\n\nAll workers operate in the same repo directory on the same branch. Branches/worktrees are too heavyweight.\n\n## Simplified approach: Manifest-scoped diff\n\nThe manifest already defines which files each worker owns. Use that to scope the review:\n\n```bash\n# Orchestrator knows worker's manifest\nfiles=\"src/foo.zig src/bar.zig\"\n\n# Pipe only those files' diff to codex\ngit diff -- $files | codex review -\n```\n\nOr for uncommitted + untracked (matching --uncommitted behavior):\n```bash\ngit diff -- $files \u003e /tmp/review-input.diff\ngit diff --cached -- $files \u003e\u003e /tmp/review-input.diff\ngit ls-files --others --exclude-standard -- $files \u003e\u003e /tmp/review-input.diff\ncodex review - \u003c /tmp/review-input.diff\n```\n\n## Implementation\n\n1. When worker signals READY_FOR_REVIEW, orchestrator looks up manifest\n2. Builds file list from `manifest.primary_files`\n3. Generates scoped diff\n4. Passes to codex via stdin\n\nThis keeps the single-worktree model and uses the manifest as the source of truth for ownership.","created_at":"2025-12-10T22:39:04Z"}]}
{"id":"noface-1v7","title":"Replace batch-based scheduling with greedy dependency+lock scheduler","description":"The current batch-based scheduling architecture is redundant and causes idle workers.\n\n## Current Architecture (problematic)\n\n1. `generateBatchesFromManifests()` pre-groups ready issues by manifest conflicts\n2. `executeBatch()` blocks until ALL issues in current batch complete\n3. Workers only get assigned issues from current batch\n4. Result: idle workers waiting for batch completion even when non-conflicting work exists\n\n## Why Batches Are Redundant\n\nThe batch pre-grouping does the same conflict check that happens at runtime:\n\n**Planning time (generateBatchesFromManifests, loop.zig:1148):**\n```zig\nif (state.issuesConflict(issue_id, batch_issue_id)) {\n    conflicts = true;\n```\n\n**Execution time (worker_pool.zig:213):**\n```zig\nconst locks_acquired = self.state.tryAcquireLocks(issue_id, manifest, worker_id);\nif (!locks_acquired) continue;  // Skip conflicting issue\n```\n\nThe lock system already prevents conflicts. Batches just add artificial serialization.\n\n## Proposed Architecture\n\nReplace batch execution with a simple greedy scheduler:\n\n```\nwhile has_ready_work:\n    ready_issues = \\`bd ready\\`  # dependency-satisfied issues\n    \n    for each idle_worker:\n        for each ready_issue not already in_progress:\n            if tryAcquireLocks(issue):\n                assign(worker, issue)\n                break\n    \n    poll_running_workers()\n    handle_completions()  # releases locks, may unblock new issues\n    sleep(poll_interval)\n```\n\n## Benefits\n\n- **Maximum parallelism**: Workers never idle when non-conflicting work exists\n- **Simpler code**: Remove Batch struct, generateBatchesFromManifests, batch iteration logic\n- **Same correctness**: Dependencies enforced by \\`bd ready\\`, conflicts by lock acquisition\n- **Dynamic adaptation**: New ready issues (from completed dependencies) picked up immediately\n\n## Files to Modify\n\n- `src/state.zig`: Remove Batch struct, pending_batches, batch-related methods\n- `src/worker_pool.zig`: Replace executeBatch() with runSchedulerLoop()\n- `src/loop.zig`: Remove generateBatchesFromManifests(), simplify main loop","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T14:29:26.214697-08:00","updated_at":"2025-12-10T14:29:26.214697-08:00"}
{"id":"noface-2qg","title":"Add BLOCKED status with human escalation summary","description":"Define clear escalation threshold with actionable summary.\n\nAfter N consecutive failed attempts (e.g., 3) or severe failure type:\n1. Mark issue as BLOCKED\n2. Post a summary:\n   - What was tried\n   - Errors encountered\n   - What the agent thinks is unclear (if any)\n3. Pause automation until human:\n   - Adds context\n   - Edits the issue, or\n   - Manually unblocks / retries\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:03:49.636111-08:00","updated_at":"2025-12-10T12:03:49.636111-08:00","labels":["failure-recovery","human-in-loop"]}
{"id":"noface-3eh","title":"Add timeout handling for hung agents","description":"If an agent process doesn't produce output for a configurable timeout (default: 5 minutes), kill it and report an error.\n\nThis prevents noface from hanging indefinitely if Claude or Codex gets stuck.\n\nAdd config option:\n```toml\n[agents]\ntimeout_seconds = 300\n```","acceptance_criteria":"- Agent process that produces no output for agents.timeout_seconds (default 300s) is terminated and marked failed\n- Config accepts override; zero/negative values rejected\n- Timeout is logged and surfaced in run summary/exit codes\n- Worker resources/locks are cleaned up after timeout and retriable\n- Tests cover timeout kill path and recovery","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T23:00:26.530001-08:00","updated_at":"2025-12-10T07:11:30.00072-08:00","closed_at":"2025-12-10T07:11:30.00072-08:00"}
{"id":"noface-3le","title":"Add static analysis integration (hard/soft gates)","description":"Integrate whatever static analysis the repo already has.\n\nHard gates (block on failure):\n- Type errors (zig build, tsc, mypy)\n- Formatter failures (zig fmt, prettier)\n\nSoft gates (log, maybe create follow-up):\n- New lint warnings\n- Security scanner findings (unless critical)\n\nConfig:\n[verification.static_analysis]\nhard_gates = ['zig build', 'zig fmt --check']\nsoft_gates = ['clippy', 'eslint']\n\nReference: [[verification]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:04:46.516271-08:00","updated_at":"2025-12-10T12:04:46.516271-08:00","labels":["static-analysis","verification"]}
{"id":"noface-3m7","title":"Add judge agent for semantic verification","description":"Add semantic check step for complex issues.\n\nOption 1: Explicit reasoning\n- Have implementer/reviewer write: 'Here is how the change addresses the issue...'\n- Check coherence between explanation and diff\n\nOption 2: Judge agent\n- Input: issue description + old code + new code\n- Question: 'Does this change resolve the described behavior? Is anything missing or unrelated?'\n\nDoesn't need to be perfect; even catching obvious mismatches is a big win.\n\nReference: [[verification]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:04:48.718307-08:00","updated_at":"2025-12-10T12:04:48.718307-08:00","labels":["semantic","verification"]}
{"id":"noface-4h2","title":"Align CLI flags with design doc naming (scrum vs planner)","description":"Design doc documents scrum flags/keys (--no-scrum, --scrum-interval, [passes].scrum_enabled/scrum_interval) but the CLI/template only expose planner_* names. Users following the README can't configure passes correctly.","design":"README.md \u003e CLI Options \u0026 Configuration","acceptance_criteria":"- CLI supports --no-scrum/--scrum-interval flags; --help text uses design terminology (keep planner aliases for compatibility).\\n- Config parser accepts scrum_enabled/scrum_interval keys and init template emits them.\\n- Tests cover new flags/config paths; planner behavior continues to work through unified config fields.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T23:18:09.11498-08:00","updated_at":"2025-12-10T14:15:09.651456-08:00","closed_at":"2025-12-10T14:15:09.651456-08:00","comments":[{"id":5,"issue_id":"noface-4h2","author":"femtomc","text":"MANIFEST: primary=[src/main.zig,src/config.zig,README.md] read=[src/loop.zig] forbidden=[src/web.zig]","created_at":"2025-12-10T17:14:33Z"},{"id":14,"issue_id":"noface-4h2","author":"femtomc","text":"MANIFEST: primary=[src/main.zig,src/config.zig,README.md] read=[src/loop.zig] forbidden=[]","created_at":"2025-12-10T20:40:21Z"},{"id":22,"issue_id":"noface-4h2","author":"femtomc","text":"MANIFEST: primary=[src/main.zig,src/config.zig,README.md] read=[src/loop.zig] forbidden=[]","created_at":"2025-12-10T21:37:01Z"}]}
{"id":"noface-5g3","title":"Implement soft gate to follow-up issue creation","description":"When soft gates fail, create follow-up issues instead of blocking.\n\nSoft gates:\n- Lint warnings\n- Coverage thresholds\n- Reviewer 'nit' comments\n\nPolicy:\n- Automated merge requires all hard gates\n- Soft gate failures:\n  - Either block and open follow-up issue, or\n  - Allow merge but log warnings and create cleanup issues\n\nReference: [[verification]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:04:56.728197-08:00","updated_at":"2025-12-10T12:04:56.728197-08:00","labels":["verification"]}
{"id":"noface-5r0","title":"Implement dynamic context budget based on issue complexity","description":"Make context budget dynamic instead of fixed max_context_docs = 5.\n\nApproach:\n- Define target fraction of prompt tokens for retrieved docs (e.g., 30-40%)\n- Fill slot with as many top-ranked docs as fit\n- Complexity heuristics:\n  - More files / cross-cutting change → allow more docs\n  - Tiny, local change → maybe 0-2 docs only\n\nKeep max_context_docs as hard cap, but choose K ∈ [0, max] per issue.\n\nReference: [[context-injection]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:01:45.323206-08:00","updated_at":"2025-12-10T12:01:45.323206-08:00","labels":["context","prompts"]}
{"id":"noface-6ql","title":"Implement exclusion list for context retrieval","description":"Define explicit exclusions for context retrieval:\n\nPath-based:\n- vendor/, node_modules/, dist/, build/, .cache/\n- *.min.js, large generated protobufs\n\nSize-based:\n- Files \u003e X KB not included unless explicitly requested\n\nType-based:\n- Binary blobs, lockfiles, big JSON dumps\n\nImplement in retrieval pipeline so excluded files never show up as candidates.\n\nReference: [[context-injection]] design doc","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T12:01:52.219219-08:00","updated_at":"2025-12-10T12:01:52.219219-08:00","labels":["context","retrieval"]}
{"id":"noface-7qx","title":"Wire monowiki design vault into planner","description":"Planner/implementation runs currently don't know where the design documents live. Configure noface to use the hongseok monowiki vault so the planner and agents automatically pull context from the orchestrator and microagent design docs.\nInclude a way to set the vault path in .noface.toml/CLI, validate monowiki availability, and surface a clear warning when the vault is missing.","design":"orchestrator, microagent (hongseok monowiki)","acceptance_criteria":"- .noface.toml supports a [monowiki] block pointing at /Users/femtomc/docs/hongseok/vault (or equivalent CLI flag) and the path is read by noface at startup\n- Planner/implementation prompts show monowiki commands against that vault and can fetch orchestrator/microagent docs when available\n- Missing monowiki CLI or vault path produces a non-fatal warning and planner continues without crashing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T23:07:11.610328-08:00","updated_at":"2025-12-09T23:14:23.005181-08:00","closed_at":"2025-12-09T23:14:23.005181-08:00"}
{"id":"noface-8fp","title":"Verify file changes against manifest after agent runs","description":"After an implementation agent completes, check git diff against the issue's manifest. If agent modified files outside primary_files or touched forbidden_files, rollback and record violation. Implement in loop.zig after agent completion.","acceptance_criteria":"verifyManifestCompliance function checks git diff; Unauthorized changes trigger rollback; Violations recorded in state.AttemptRecord; Agent retried with stricter prompt on violation","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T06:45:55.868754-08:00","updated_at":"2025-12-10T08:02:54.861142-08:00","closed_at":"2025-12-10T08:02:54.861142-08:00","dependencies":[{"issue_id":"noface-8fp","depends_on_id":"noface-gsk","type":"blocks","created_at":"2025-12-10T06:46:13.284984-08:00","created_by":"daemon"}]}
{"id":"noface-8x3","title":"Add hybrid ranking for context (BM25 + embeddings)","description":"Replace simple wikilink fetching with hybrid ranking:\n\nPipeline:\n1. Candidate generation:\n   - Wikilinks / explicit references from issue\n   - BM25 search (already have src/bm25.zig)\n\n2. Re-ranking:\n   - Embedding similarity (doc ↔ issue description)\n\n3. Final score:\n   score = α * BM25 + β * embedding_score + boost_if_explicitly_linked\n\nReference: [[context-injection]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:01:47.763258-08:00","updated_at":"2025-12-10T12:01:47.763258-08:00","labels":["context","retrieval"]}
{"id":"noface-a2b","title":"Add model escalation policy","description":"Define a simple model escalation policy for failures:\n\nFor each issue:\n- First 1-2 attempts: default_model (cheaper)\n- If still failing with correctable errors (tests, syntax): escalate to strong_model\n- Cap total attempts across all models\n\nConfig:\n[retry]\ndefault_model = 'claude-sonnet'\nescalation_model = 'claude-opus'\nescalate_after_attempts = 2\nmax_total_attempts = 5\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:03:44.827387-08:00","updated_at":"2025-12-10T12:03:44.827387-08:00","labels":["config","failure-recovery"]}
{"id":"noface-a8g","title":"Replace ad-hoc TOML parsing with a real parser + validation","description":"Config.parseToml (src/config.zig) manually splits lines and only handles trivial key=value strings; it ignores inline comments, escapes, arrays, and nested tables, and silently trims quotes instead of parsing types. Valid TOML like strings containing '=' or booleans with inline comments are misread, which makes .noface.toml brittle and hard to debug. Swap in a proper TOML parser or at least a stricter validation layer that rejects malformed input and surfaces errors with file/line context.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-10T08:59:16.677421-08:00","updated_at":"2025-12-10T14:39:31.151796-08:00","comments":[{"id":10,"issue_id":"noface-a8g","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,src/main.zig] read=[README.md,src/loop.zig] forbidden=[src/web.zig]","created_at":"2025-12-10T17:14:54Z"},{"id":19,"issue_id":"noface-a8g","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,build.zig,build.zig.zon] read=[src/main.zig,README.md] forbidden=[]","created_at":"2025-12-10T20:40:41Z"},{"id":26,"issue_id":"noface-a8g","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,build.zig,build.zig.zon,src/main.zig] read=[README.md,src/loop.zig] forbidden=[]","created_at":"2025-12-10T21:37:23Z"}]}
{"id":"noface-ajs","title":"Add reviewer pass with risk-based triggering","description":"Add a dedicated reviewer agent pass, but only for high-risk changes.\n\nTrigger reviewer when:\n- Diff size \u003e threshold\n- Changed files in security/, auth/, infra/, config/\n- No tests exist or coverage is low\n\nSkip for low-risk, tiny changes where tests are strong.\n\nReviewer inputs: issue description, old vs new diff, test results\nReviewer outputs: OK / NOT_OK / NEEDS_HUMAN + specific comments\n\nReference: [[multi-pass]] and [[verification]] design docs","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:02:37.985361-08:00","updated_at":"2025-12-10T12:02:37.985361-08:00","labels":["multi-pass","reviewer"]}
{"id":"noface-ang","title":"Implement replan-on-violation flow","description":"When an agent attempts to touch a non-manifest file:\n1. Reject that attempt\n2. Spawn a replan: run planner again with the new file explicitly mentioned\n3. Re-run implementation under the new manifest\n\nNever accept a violation directly - use violations as hints for replanning.\n\nReference: [[manifests]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:00:19.182053-08:00","updated_at":"2025-12-10T12:00:19.182053-08:00","labels":["manifests","planner"],"comments":[{"id":28,"issue_id":"noface-ang","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/state.zig,src/worker_pool.zig] read=[src/process.zig,README.md] forbidden=[]","created_at":"2025-12-10T21:37:33Z"}]}
{"id":"noface-au9","title":"State persistence relies on hand-rolled JSON with no schema/versioning","description":"State save/load in src/state.zig (writeJson/parseJson around lines 260-520) manually concatenates and string-searches JSON. Escaping, nesting, and unknown fields are not handled, so any brace or quote in ids/notes can corrupt state, and additions silently drop on load. There is no schema or version upgrade path, so state.json round-trips are brittle and hard to test. Replace with structured encode/decode (std.json or a serde helper) plus explicit versioned schema and migrations, and add round-trip tests that cover manifests, batches, locks, attempt records, and future fields.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T14:28:28.245205-08:00","updated_at":"2025-12-10T14:28:28.245205-08:00"}
{"id":"noface-b0h","title":"noface serve is missing live dashboard APIs","description":"The Zig web server at src/web.zig only serves static assets plus /api/issues and /api/state; /api/sessions returns {} and there is no /ws endpoint. The frontend (web/src/hooks/useWebSocket.ts) expects a websocket for live updates and session playback, and the Bun dev server (web/server/index.ts) streams issues/state and summarizes session logs from /tmp. Bring noface serve to parity by wiring a websocket endpoint and real /api/sessions that reads recent noface-session-*.json logs.","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2025-12-10T08:58:59.697929-08:00","updated_at":"2025-12-10T13:40:54.15108-08:00","comments":[{"id":9,"issue_id":"noface-b0h","author":"femtomc","text":"MANIFEST: primary=[src/web.zig] read=[web/server/index.ts,web/src/hooks/useWebSocket.ts,src/web_assets.zig] forbidden=[src/loop.zig]","created_at":"2025-12-10T17:14:49Z"},{"id":18,"issue_id":"noface-b0h","author":"femtomc","text":"MANIFEST: primary=[src/web.zig,src/web_assets.zig,web/src/hooks/useWebSocket.ts] read=[web/server/index.ts,src/state.zig,src/process.zig] forbidden=[]","created_at":"2025-12-10T20:40:37Z"},{"id":25,"issue_id":"noface-b0h","author":"femtomc","text":"MANIFEST: primary=[src/web.zig] read=[web/server/index.ts,web/src/hooks/useWebSocket.ts,README.md,src/transcript.zig] forbidden=[]","created_at":"2025-12-10T21:37:17Z"}]}
{"id":"noface-bfd","title":"Show progress indicator during long operations","description":"Add a simple progress indicator (spinner or dots) when waiting for:\n- Agent responses\n- Build commands\n- Test runs\n\nThis gives users feedback that noface is still working.","acceptance_criteria":"- Progress indicator (spinner/dots) shows during agent responses, build commands, and test runs\n- Indicator respects quiet/non-interactive modes and does not garble normal logs\n- Hides/finishes cleanly when operation completes or errors\n- Basic tests cover indicator toggle and formatting","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-09T23:00:28.958713-08:00","updated_at":"2025-12-10T06:52:35.776279-08:00"}
{"id":"noface-bms","title":"Implement adaptive concurrency for worker pool","description":"Replace fixed concurrency with adaptive scaling:\n\nConfig:\n  max_concurrent_global = 8\n  max_concurrent_per_repo = 4\n  initial_concurrency = 2\n\nPolicy:\n1. Start with N = 2\n2. If queue backlog grows and success rate is high → increase toward max\n3. If failures/timeouts increase → back off\n\nReference: [[parallel-execution]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:01:03.88726-08:00","updated_at":"2025-12-10T12:01:03.88726-08:00","labels":["parallelism","workers"]}
{"id":"noface-bqz","title":"Attach quality findings to follow-up issues","description":"When quality pass opens follow-up issues, attach:\n- Links to the original issue\n- The quality agent's analysis (e.g., 'didn't handle null case in X')\n\nWhen implementer picks up follow-up issue, include analysis in prompt:\n  'The previous attempt failed because: [list]. Fix these specific problems.'\n\nThis turns quality pass into a teacher, not just a bug generator.\n\nReference: [[multi-pass]] design doc","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T12:02:40.050312-08:00","updated_at":"2025-12-10T12:02:40.050312-08:00","labels":["multi-pass","quality"]}
{"id":"noface-bs5","title":"Show tool parameters in streaming output","description":"When Claude uses tools during implementation, only the tool name is shown (e.g. '[TOOL] Read'). This makes it hard to follow what the agent is doing. Should extract and display key parameters: file_path for Read/Edit, command for Bash, etc.","acceptance_criteria":"Tool output shows contextual info like '[TOOL] Read src/config.zig' or '[TOOL] Bash: zig build test'","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-09T23:22:21.074744-08:00","updated_at":"2025-12-09T23:24:42.472851-08:00","closed_at":"2025-12-09T23:24:42.472851-08:00"}
{"id":"noface-bw7","title":"Add human review gate for high-risk paths","description":"Build risk classification with hard human gate for sensitive areas.\n\nHigh-risk triggers:\n- Files/directories: auth/, payments/, secrets/, infra/, prod-config/\n- Labels: security, compliance, breaking-change\n\nFor high-risk changes:\n- noface never auto-merges\n- Opens PR or surfaces diff with 'requires human approval' flag\n- Optionally pre-annotated with AI reviewer's comments\n\nConfig:\n[verification.human_required]\npaths = ['src/auth/', 'src/payments/', 'config/prod/']\nlabels = ['security', 'compliance']\n\nReference: [[verification]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:04:54.386954-08:00","updated_at":"2025-12-10T12:04:54.386954-08:00","labels":["human-in-loop","verification"]}
{"id":"noface-c3d","title":"Fix BLOCKED_BY_FILE parsing extracting JSON garbage instead of file path","description":"The checkForBlockedSignal function in worker_pool.zig:1049 searches for BLOCKED_BY_FILE: in the raw output buffer, which includes Claude API JSON responses. When Claude outputs text containing this signal, the surrounding JSON structure gets included in the extracted file path.\n\nExample from trace:\n```\n[POOL] Worker 1 reported blocked on src/loop.zig\"}],\"stop_reason\":null...\n```\n\nThe output buffer contains raw streaming JSON like:\n```json\n{\"content\":\"BLOCKED_BY_FILE: src/loop.zig\"}],\"stop_reason\":null...\n```\n\nRoot cause: Substring search finds the signal inside a JSON string value, then extracts everything until newline - including JSON syntax.\n\nImpact: Workers report blocked on invalid file paths, the file is never found as locked, so workers are never properly marked as waiting and cannot be woken up.\n\nFix options:\n1. Parse text content from JSON events first, then search for the signal\n2. Require BLOCKED_BY_FILE: to be at the start of a line\n3. Add JSON-awareness to avoid matching inside quoted strings","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-10T14:17:52.368849-08:00","updated_at":"2025-12-10T14:17:52.368849-08:00","comments":[{"id":31,"issue_id":"noface-c3d","author":"femtomc","text":"Additional case discovered: Read tool output contamination\n\nWhen a worker reads source files (e.g., worker_pool.zig itself), the Read tool output contains the prompt template which includes:\n```\n\\\\If blocked by another engineer's file, output: BLOCKED_BY_FILE: \u003cpath\u003e\n```\n\nThe signal detection then matches this template text, extracting garbage like:\n```\n[POOL] Worker 1 reported blocked on \u003cpath/to/file.zig\u003e\\n   399→            \\\\\\\\   - The orchestrator will pause you...\n```\n\nThis means the fix must distinguish between:\n1. JSON API response content (streaming events)\n2. Tool output (Read, Grep, etc.) embedded in the response\n3. Actual agent text output intended as a signal\n\nSuggested approach: Only match BLOCKED_BY_FILE: when it appears as a standalone line in parsed assistant text content, not in any tool results or raw JSON.","created_at":"2025-12-10T22:31:24Z"}]}
{"id":"noface-ccs","title":"Add failure_hints config section","description":"Add lightweight rule-based 'lessons' for common failure patterns.\n\nConfig:\n[[failure_hints]]\nlabel = 'migration'\nhint = 'Migration issues often need schema changes first. Check schema files.'\n\n[[failure_hints]]\nlanguage = 'zig'\nerror_pattern = 'error.OutOfMemory'\nhint = 'Consider using an arena allocator for temporary allocations.'\n\nPeriodically review failure logs, add new rules where patterns are obvious.\n\nReference: [[failure-recovery]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:03:51.74688-08:00","updated_at":"2025-12-10T12:03:51.74688-08:00","labels":["config","failure-recovery"]}
{"id":"noface-cs6","title":"Handle agent-requested context signals (NEED_CODE/NEED_DOC)","description":"Implement context-injection decision #6: detect agent requests for extra context (NEED_CODE/NEED_DOC), fetch the referenced code/doc snippets via retrieval or harness APIs, and re-prompt with the added context while enforcing manifest/lock rules.","design":"context-injection","acceptance_criteria":"• Agent outputs NEED_CODE/NEED_DOC are parsed and recorded during runs.\n• Orchestrator fetches the requested content (or rejects with reason if forbidden/locked) and feeds it into the next prompt/turn.\n• Requests and responses are logged (for observability) and respect manifest + lock constraints.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:19:58.78453-08:00","updated_at":"2025-12-10T12:19:58.78453-08:00"}
{"id":"noface-dgt","title":"Parse confidence/risk metadata from agent output","description":"Ask agent to output explicit confidence and risks.\n\nPrompt addition:\n  After implementing, output:\n  CONFIDENCE: X/5\n  RISKS:\n  - [list any edge cases or uncertainties]\n\nPolicy:\n- If confidence ≤ 2/5 → require reviewer + maybe human\n- Also watch for heuristics:\n  - Lots of TODOs in output\n  - 'I think / maybe' in comments\n  - Weirdly small or huge diffs\n\nReference: [[verification]] design doc","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T12:04:52.306911-08:00","updated_at":"2025-12-10T12:04:52.306911-08:00","labels":["prompts","verification"]}
{"id":"noface-djm","title":"Implement eager work-stealing across batches for idle workers","description":"Currently executeBatch() in worker_pool.zig:102 blocks until ALL issues in the current batch complete before moving to the next batch. Workers only get assigned issues from the current batch (lines 206-234).\n\nThis causes idle workers when:\n- Batch has fewer issues than workers (e.g., Batch 6 has 2 issues, 3 workers available)\n- A worker completes but other workers are still running on the same batch\n\nExample from trace:\n```\n[POOL] Executing batch 6 with 2 issue(s) using 3 worker(s)\n[POOL] Assigned issue noface-e4p to worker 0\n[POOL] Assigned issue noface-b0h to worker 1\n# Worker 2 sits idle - nothing in Batch 6 to assign\n[POOL] Worker 0 completed issue noface-4h2 in 342s\n# Worker 0 now idle, but Batches 7-12 have work available\n```\n\nProposed fix: When a worker becomes idle and current batch has no unassigned issues:\n1. Check pending_batches for issues that don't conflict with currently-running workers\n2. If non-conflicting issue found, assign it (respecting lock acquisition)\n3. Track which batch each assigned issue came from for proper completion accounting\n\nThis maintains the dependency ordering (batch N issues complete before batch N+1 issues that depend on them) while maximizing worker utilization for independent work.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T14:26:23.825148-08:00","updated_at":"2025-12-10T14:29:23.377523-08:00","closed_at":"2025-12-10T14:29:23.377523-08:00"}
{"id":"noface-dxk","title":"Event-driven quality pass triggers","description":"Quality pass should run on signals (batch completion, failure spikes) per [[multi-pass]] design decision #1. Keep interval as fallback but add event-driven triggers: after batch completion, when failure/timeout rate spikes, or when backlog reprioritized. Expose config to select event-driven vs interval.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T13:39:41.134466-08:00","updated_at":"2025-12-10T13:39:41.134466-08:00","labels":["planner"]}
{"id":"noface-dyf","title":"Event-driven planner instead of interval-based","description":"Currently planner runs every N iterations. Change to event-driven: run planner only when (1) no ready issues, (2) breakdown requested, (3) batch completed and need new batch. Reduces unnecessary planner invocations and token cost.","acceptance_criteria":"Planner runs on-demand not on interval; Triggered by empty queue or batch completion; Config option to choose mode; Token usage reduced","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-10T06:47:04.597739-08:00","updated_at":"2025-12-10T14:38:38.240798-08:00","closed_at":"2025-12-10T14:38:38.240798-08:00","comments":[{"id":8,"issue_id":"noface-dyf","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/config.zig,src/main.zig] read=[README.md] forbidden=[src/web.zig]","created_at":"2025-12-10T17:14:45Z"},{"id":17,"issue_id":"noface-dyf","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/config.zig,src/state.zig] read=[README.md] forbidden=[]","created_at":"2025-12-10T20:40:33Z"},{"id":24,"issue_id":"noface-dyf","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/config.zig,src/main.zig,README.md] read=[src/state.zig,src/worker_pool.zig] forbidden=[]","created_at":"2025-12-10T21:37:12Z"}]}
{"id":"noface-dym","title":"LSP integration for semantic code navigation","description":"Integrate with language servers (zls, rust-analyzer, gopls, etc.) to provide semantic code navigation tools for agents. Spawn LSP as subprocess, communicate via JSON-RPC. Expose tools: goto_definition, find_references, list_symbols, get_callers/callees. Build code graph at startup for fast queries.","acceptance_criteria":"LSP client spawns and initializes language server; goto_definition and find_references work; Code graph cached for call hierarchy queries; Graceful fallback when LSP unavailable","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T07:09:30.867209-08:00","updated_at":"2025-12-10T07:09:30.867209-08:00","dependencies":[{"issue_id":"noface-dym","depends_on_id":"noface-noy","type":"blocks","created_at":"2025-12-10T07:09:40.988372-08:00","created_by":"daemon"}]}
{"id":"noface-e4p","title":"Add --verbose flag for detailed logging","description":"Add a --verbose/-V flag that enables more detailed logging output during execution. When enabled, show:\n- Full commands being executed\n- Timing information for each step\n- Agent prompts being sent (truncated)\n- Raw API responses (summarized)\n\nThis helps with debugging when things go wrong.","acceptance_criteria":"- --verbose/-V flag exists (default off) and parsed via CLI/config\n- Verbose mode prints executed commands, step timings, truncated prompts, summarized API responses\n- Normal mode output remains unchanged/minimal; verbose respects log level for subcomponents\n- Tests cover flag parsing and representative verbose output toggle","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-09T23:00:12.682282-08:00","updated_at":"2025-12-10T13:40:55.666395-08:00","comments":[{"id":3,"issue_id":"noface-e4p","author":"femtomc","text":"MANIFEST: primary=[src/main.zig,src/config.zig,src/loop.zig,src/process.zig] read=[src/worker_pool.zig,README.md] forbidden=[]","created_at":"2025-12-10T17:14:25Z"},{"id":12,"issue_id":"noface-e4p","author":"femtomc","text":"MANIFEST: primary=[src/main.zig,src/config.zig,src/loop.zig,src/process.zig,src/streaming.zig,README.md] read=[src/markdown.zig,src/state.zig] forbidden=[]","created_at":"2025-12-10T20:40:14Z"},{"id":21,"issue_id":"noface-e4p","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,src/main.zig,src/loop.zig,src/process.zig,README.md] read=[src/streaming.zig,src/transcript.zig] forbidden=[]","created_at":"2025-12-10T21:36:56Z"}]}
{"id":"noface-eua","title":"Streaming/log parsing duplicated and ad-hoc across paths","description":"We have two unrelated streaming parsers: src/streaming.zig drives sequential runs, while workers parse stdout by substring in src/worker_pool.zig:860-1075 (including BLOCKED_BY_FILE detection). The worker path ignores the shared parser/tool summaries, has no structured event model, and the duplication already caused bugs like garbage BLOCKED_BY_FILE matches. Unify on one streaming/event pipeline that produces structured events (text, tool uses, blocked signals) for both sequential and pool runs, and feed the same events into transcripts/websocket updates so behavior stays consistent.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T14:29:00.384383-08:00","updated_at":"2025-12-10T14:29:00.384383-08:00"}
{"id":"noface-f77","title":"Worker timeout should track idle output, not wall-clock runtime","description":"agent_timeout_seconds is documented as \"Kill agent if no output for N seconds\" (src/main.zig:108), and streaming runs enforce it based on idle output. In the worker pool path (src/worker_pool.zig:320-360) we instead kill a worker once elapsed wall time exceeds the timeout, even if it is still producing output (e.g., long builds/tests). That causes false positives and interrupts successful work. Track last-output heartbeat from workers (or use a generous wall clock + idle threshold) so only idle workers are terminated, and add coverage around long-running but chatty workers.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-10T08:58:43.812024-08:00","updated_at":"2025-12-10T12:43:17.812698-08:00","comments":[{"id":2,"issue_id":"noface-f77","author":"femtomc","text":"MANIFEST: primary=[src/worker_pool.zig,src/process.zig] read=[src/config.zig,src/loop.zig] forbidden=[]","created_at":"2025-12-10T17:14:20Z"},{"id":11,"issue_id":"noface-f77","author":"femtomc","text":"MANIFEST: primary=[src/worker_pool.zig] read=[src/process.zig,src/loop.zig,src/main.zig] forbidden=[]","created_at":"2025-12-10T20:40:10Z"}]}
{"id":"noface-fp4","title":"Planner groups issues into parallel batches","description":"Enhance planner to analyze issue manifests and group non-conflicting issues into parallel batches. Issues with disjoint primary_files can run in same batch. Output BATCH blocks with issue lists. Store batches in state.Batch.","acceptance_criteria":"Planner outputs PARALLEL_BATCH sections; Batches stored in orchestrator state; Issues within batch have no file conflicts; Batches respect beads dependency ordering","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T06:46:13.341275-08:00","updated_at":"2025-12-10T08:17:56.446753-08:00","closed_at":"2025-12-10T08:17:56.446753-08:00","dependencies":[{"issue_id":"noface-fp4","depends_on_id":"noface-gsk","type":"blocks","created_at":"2025-12-10T06:46:26.902582-08:00","created_by":"daemon"}]}
{"id":"noface-gsk","title":"Planner generates file manifests for issues","description":"Enhance the planner prompt to analyze each issue and predict which files will be modified. Store manifests in state.IssueState or as beads comments. Manifests include: primary_files (exclusive write), read_files (shared read), forbidden_files (must not touch).","acceptance_criteria":"Planner outputs MANIFEST blocks for issues; Manifests parsed and stored in orchestrator state; bd comments store manifest for persistence across runs","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T06:45:44.237005-08:00","updated_at":"2025-12-10T07:33:48.733303-08:00","closed_at":"2025-12-10T07:33:48.733303-08:00"}
{"id":"noface-h9g","title":"Parse NEED_CODE signals from agent output","description":"Add structured handling for agent context requests per [[context-injection]] (Agent-Requested Context). Detect lines like 'NEED_CODE: path/to/file' in agent output, fetch the referenced code snippet, and re-prompt with that context (without changing manifest). Log requests and respect manifest/lock constraints.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T13:39:52.707606-08:00","updated_at":"2025-12-10T13:39:52.707606-08:00","labels":["context"]}
{"id":"noface-hq3","title":"Auto-detect languages and configure LSPs in noface init","description":"Enhance noface init to scan the project for language markers (build.zig, Cargo.toml, package.json, etc.), detect which LSPs are needed, check availability, and configure .noface.toml automatically. Optionally use an initializer agent for complex setups.","acceptance_criteria":"Language detection from file extensions and build files; LSP availability check with install suggestions; Generated .noface.toml includes [lsp] config; Works for mono-repos with multiple languages","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T07:09:30.923312-08:00","updated_at":"2025-12-10T07:09:30.923312-08:00","dependencies":[{"issue_id":"noface-hq3","depends_on_id":"noface-dym","type":"blocks","created_at":"2025-12-10T07:09:41.029-08:00","created_by":"daemon"}]}
{"id":"noface-ibi","title":"Implement scratch branch model for partial progress","description":"Preserve partial progress without exposing half-baked changes to main.\n\nDesign:\n- Each issue has a scratch branch or temp workspace\n- Each attempt commits to that branch\n- If one file fails, you still keep the other 3 as commits in the branch\n- Only when tests + gates pass do you merge that branch to main\n\nThis preserves partial progress for future attempts.\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:03:42.618275-08:00","updated_at":"2025-12-10T12:03:42.618275-08:00","labels":["failure-recovery","git"]}
{"id":"noface-igq","title":"Add function-level hints to prompt builder","description":"While keeping file-level manifests as the hard safety boundary, add soft function-level hints in the prompt:\n\nExample:\n  You may edit only these functions in foo.zig: [foo, bar].\n\nThis provides guidance without requiring language-aware parsing for enforcement.\n\nReference: [[manifests]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:00:25.16998-08:00","updated_at":"2025-12-10T12:00:25.16998-08:00","labels":["manifests","prompts"]}
{"id":"noface-ius","title":"Add test coverage checking gate","description":"Add test-centric enhancements for changes that add new behavior.\n\nFor changes that add new behavior:\n- Ask agent to write or update tests as part of the task\n- If coverage tool exists, run coverage diff:\n  - If new/changed lines have zero coverage → soft or hard gate\n\nWhere tooling is limited:\n- At least ensure: 'If tests exist in this module, check they were updated'\n- Warn if tests not updated for behavioral changes\n\nReference: [[verification]] design doc","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-10T12:04:43.301865-08:00","updated_at":"2025-12-10T12:04:43.301865-08:00","labels":["testing","verification"]}
{"id":"noface-j3n","title":"Add freshness tracking to monowiki docs","description":"Track doc freshness to downrank stale docs:\n\nFor each doc, track:\n- last_updated timestamp\n- Optionally 'tied-to-commit' info\n\nHeuristics:\n- If doc references symbols that no longer exist → heavily downrank\n- If now - last_updated \u003e threshold and code changed → downrank\n\nIn prompt, for borderline docs:\n  'Note: this doc may be outdated; prefer current code as source of truth.'\n\nReference: [[context-injection]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:01:50.411444-08:00","updated_at":"2025-12-10T12:01:50.411444-08:00","labels":["context","monowiki"]}
{"id":"noface-jba","title":"Implement multi-process worker pool","description":"Replace sequential agent execution with parallel worker pool. Spawn N worker processes (configurable via num_workers). Each worker runs its own agent session. Coordinator assigns issues from current batch to idle workers. Use state.WorkerState to track lifecycle.","acceptance_criteria":"WorkerPool struct manages N child processes; Workers execute in parallel; Coordinator waits for batch completion before next batch; Worker crashes detected and recovered","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T06:46:26.958412-08:00","updated_at":"2025-12-10T08:51:57.417587-08:00","closed_at":"2025-12-10T08:51:57.417587-08:00","dependencies":[{"issue_id":"noface-jba","depends_on_id":"noface-fp4","type":"blocks","created_at":"2025-12-10T06:46:41.28963-08:00","created_by":"daemon"},{"issue_id":"noface-jba","depends_on_id":"noface-8fp","type":"blocks","created_at":"2025-12-10T06:46:41.329746-08:00","created_by":"daemon"}]}
{"id":"noface-jvi","title":"Implement self-reflection step for retries","description":"Add optional self-reflection step before retry:\n\n1. Ask model: 'Explain why your last attempt failed and how you will fix it'\n2. Feed that reflection back into the actual implementation prompt\n\nThis helps the model reason about its mistakes before trying again.\n\nReference: [[failure-recovery]] design doc","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-10T12:03:37.381576-08:00","updated_at":"2025-12-10T12:03:37.381576-08:00","labels":["failure-recovery","prompts"]}
{"id":"noface-jwo","title":"Add retry logic for transient agent failures","description":"When Claude or Codex fails due to transient errors (rate limits, network issues, API errors), retry with exponential backoff instead of failing immediately.\n\nImplementation:\n- Detect retryable errors (429, 5xx, network timeout)\n- Retry up to 3 times with exponential backoff (1s, 2s, 4s)\n- Log retry attempts\n- Only fail after all retries exhausted","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T23:00:13.625391-08:00","updated_at":"2025-12-09T23:29:56.158679-08:00","closed_at":"2025-12-09T23:29:56.158679-08:00"}
{"id":"noface-kaq","title":"Add serial lane for hot files","description":"When HotFileStats indicates a file is a bottleneck (high lock_count, long avg_wait), route issues touching that file to a dedicated serial queue.\n\nThis prevents parallelism overhead when a file would serialize anyway.\n\nDepends on HotFileStats tracking being implemented.\n\nReference: [[parallel-execution]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:01:06.314956-08:00","updated_at":"2025-12-10T12:01:06.314956-08:00","labels":["locking","parallelism"]}
{"id":"noface-m77","title":"Improve interrupt handling with graceful shutdown and session persistence","description":"Current interrupt handling (Ctrl+C / SIGTERM) is functional but loses work. Workers are killed immediately and Claude sessions are discarded.\n\n## Current Behavior\n\n1. Signal handler sets atomic `interrupted` flag\n2. Worker pool detects flag in next poll cycle\n3. `killAllWorkers()` sends SIGKILL to all worker processes\n4. Batch reset to `.pending`\n5. State saved, loop exits\n\n## Problems\n\n1. **Sessions lost**: Claude sessions are killed without saving session IDs - no way to resume\n2. **No graceful shutdown**: Workers get SIGKILL, not a chance to clean up\n3. **Partial work lost**: Any uncommitted changes from workers are orphaned\n4. **No progress capture**: If worker was 80% done, that context is lost\n\n## Proposed Improvements\n\n### 1. Capture session IDs before kill\n```\nOn interrupt:\n  for each worker:\n    extract claude_session_id from stream output (if available)\n    store in beads: bd comment \u003cissue\u003e \"Session interrupted. Resume ID: \u003csession_id\u003e\"\n  then kill workers\n```\n\n### 2. Graceful shutdown option\n```\nFirst Ctrl+C:  Set \"shutting_down\" flag, let workers finish current tool call\nSecond Ctrl+C: Force kill all workers (current behavior)\n```\n\n### 3. Store interrupt state in beads\n```\nbd update \u003cissue\u003e --status interrupted\nbd comment \u003cissue\u003e \"Interrupted at: \u003ctimestamp\u003e. Last action: \u003ctool_name\u003e\"\n```\n\n### 4. Resume support\nWhen restarting work on an interrupted issue:\n```\n# Check for saved session\nsession_id = bd comments \u003cissue\u003e | grep \"Resume ID\"\nif session_id:\n    claude --resume \u003csession_id\u003e -p \"You were interrupted. Continue from where you left off.\"\nelse:\n    # Fresh start with context about previous attempt\n    claude -p \"Previous attempt was interrupted. \u003ccontext\u003e\"\n```\n\n## Implementation Notes\n\n- Need to extract session_id from Claude's stream-json output during normal operation (not just at interrupt)\n- Store session_id in WorkerProcess struct as it becomes available\n- Consider adding `interrupted` as a valid IssueStatus in state.zig\n- Double-Ctrl+C pattern is common in CLI tools (docker, npm, etc.)\n\n## Files to Modify\n\n- `src/signals.zig`: Add two-phase interrupt (graceful then force)\n- `src/worker_pool.zig`: Save session IDs before kill, implement graceful shutdown\n- `src/streaming.zig`: Extract session_id from Claude output\n- `src/state.zig`: Add `interrupted` status","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T14:45:42.305267-08:00","updated_at":"2025-12-10T14:45:42.305267-08:00"}
{"id":"noface-ms6","title":"Parallel worker path bypasses manifest/review pipeline","description":"In batch mode we launch raw workers from src/worker_pool.zig:269-315 via {impl_agent} and only look at the exit code collected in collectCompletedWorkers. The single-issue path in src/loop.zig runs manifest compliance (rollback of forbidden files), codex review, build/test verification, progress file/GitHub sync, and richer logging. That whole pipeline is skipped for workers, so parallel runs can ship manifest violations or unreviewed diffs and state stays inconsistent. Refactor to share a common IssueExecutor between sequential and pool execution so both paths enforce manifest checks, review/test gates, and consistent progress/logging, then add tests that batch vs sequential produce the same lifecycle for a mocked issue.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-10T14:27:55.829392-08:00","updated_at":"2025-12-10T14:27:55.829392-08:00"}
{"id":"noface-n14","title":"Implement failure taxonomy enum","description":"Introduce a failure taxonomy and map each to a strategy:\n\n| Failure Type      | Strategy                                    |\n|-------------------|---------------------------------------------|\n| SYNTAX_ERROR      | Re-prompt with 'fix syntax error'           |\n| RUNTIME_ERROR     | Include stack trace, ask to fix             |\n| TEST_FAILURE      | Include test output, ask to fix             |\n| NO_DIFF           | 'You must change code'                      |\n| TIMEOUT           | Break down task / reduce scope              |\n| MANIFEST_VIOLATION| Replan + retry with expanded manifest       |\n| AGENT_CONFUSION   | Involve planner or human for clarification  |\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T12:03:46.70808-08:00","updated_at":"2025-12-10T12:03:46.70808-08:00","labels":["failure-recovery"]}
{"id":"noface-n9f","title":"Design structured edit format for AST-aware patching","description":"Design a structured edit format that enables AST-aware merging:\n\nInstead of raw text patches, agents emit:\n- 'Replace function foo body with ...'\n- 'Add new function bar...'\n\nBenefits:\n- Two agents modifying different functions in same file → trivially merge\n- Same function → detected as conflict\n\nThis is a middle ground between text patches and full CRDTs.\n\nReference: [[parallel-execution]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:01:11.085301-08:00","updated_at":"2025-12-10T12:01:11.085301-08:00","labels":["design","merging","parallelism"]}
{"id":"noface-noy","title":"BM25 code search index for token-efficient retrieval","description":"Implement a BM25 lexical search index that agents can use to find relevant code without full file contents in prompts. Index codebase into ~50 line chunks, provide search tool that returns file:line-range references with relevance scores. Dramatically reduces token usage for large codebases.","acceptance_criteria":"Index built at startup from source files; search() returns ranked results with file:line-range; Sub-100ms query latency on typical codebases; Integration test shows token reduction","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T07:09:15.122453-08:00","updated_at":"2025-12-10T07:09:15.122453-08:00","dependencies":[{"issue_id":"noface-noy","depends_on_id":"noface-t95","type":"blocks","created_at":"2025-12-10T07:09:41.067108-08:00","created_by":"daemon"}]}
{"id":"noface-okq","title":"Abstract model selection behind role config","description":"Abstract model selection behind roles for easy A/B testing:\n\n[models]\nplanner = 'claude'       # strong model for planning\nimplementer = 'claude'   # strong model for implementation\nreviewer = 'claude'      # can use cheaper if cost-sensitive\nquality = 'codex'        # can use cheaper for triage\n\nThis allows experimenting with different model combinations per role.\n\nReference: [[multi-pass]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:02:43.926026-08:00","updated_at":"2025-12-10T12:02:43.926026-08:00","labels":["config","multi-pass"]}
{"id":"noface-oqi","title":"Add built-in GitHub Issues sync when sync_to_github is enabled","description":"Main loop step 6 in the design doc is to sync beads issues to GitHub. Today we just call an optional shell script and otherwise do nothing, so the default sync_to_github=true does not actually mirror status upstream.","design":"README.md \u003e How It Works (step 6)","acceptance_criteria":"- Provide a built-in sync helper that uses gh CLI to create/update/close the corresponding GitHub issue for the current bead when sync_to_github is true (respect dry-run).\\n- Auto-detect target repo from git remotes or config; emit clear warnings and continue if gh is unavailable/misconfigured.\\n- Minimal test or mockable wrapper to exercise sync logic; docs/--help mention expected GitHub setup.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T23:18:18.937106-08:00","updated_at":"2025-12-10T06:16:58.593188-08:00","closed_at":"2025-12-10T06:16:58.593188-08:00"}
{"id":"noface-pko","title":"Add breakdown agent with file-split strategy","description":"Implement task breakdown for issues that are too large.\n\nTrigger breakdown when:\n- Issue times out repeatedly\n- Fails after N attempts with 'too big' signature (many files, large diff)\n\nBreakdown agent:\n- Run planner with breakdown prompt to propose sub-issues\n- e.g., 'Update schema in A', 'Update API in B', 'Update tests in C'\n- Turn these into child issues, mark parent as epic\n\nFirst version (simple):\n- Split by file: if manifest has 5 files, create 5 issues, each scoped to one file\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:03:40.168326-08:00","updated_at":"2025-12-10T12:03:40.168326-08:00","labels":["failure-recovery","planner"]}
{"id":"noface-s3n","title":"File lock acquisition before worker dispatch","description":"Before assigning issue to worker, acquire locks for all primary_files in manifest. Use state.tryAcquireLocks(). If any file locked by another issue, skip and try next issue. Release locks on completion/failure. Clean up stale locks from crashed workers.","acceptance_criteria":"Locks acquired before worker starts; Conflicting issues wait for locks; Locks released on completion; Stale lock cleanup on crash recovery","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T06:46:41.384087-08:00","updated_at":"2025-12-10T09:01:48.021876-08:00","closed_at":"2025-12-10T09:01:48.021876-08:00","dependencies":[{"issue_id":"noface-s3n","depends_on_id":"noface-jba","type":"blocks","created_at":"2025-12-10T06:46:52.164439-08:00","created_by":"daemon"},{"issue_id":"noface-s3n","depends_on_id":"noface-gsk","type":"blocks","created_at":"2025-12-10T06:52:16.683807-08:00","created_by":"daemon"}]}
{"id":"noface-st2","title":"Add failure context to retry prompts","description":"Make retries informed, not blind.\n\nOn retry, include:\n- Previous attempt's diff\n- Summarized test output / error\n- Instructions:\n  'Your previous attempt failed with: [error]. Fix that specific problem\n   while preserving working parts.'\n\nReference: [[failure-recovery]] design doc","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T12:03:34.881471-08:00","updated_at":"2025-12-10T12:03:34.881471-08:00","labels":["failure-recovery","prompts"]}
{"id":"noface-t95","title":"Minimal context via file references instead of content","description":"Reduce token cost by passing file REFERENCES instead of full content. Orchestrator pre-analyzes relevant code sections. Prompt includes pointers (file:line-range) not content. Agent uses Read tool to fetch what it needs. Trade-off: more tool calls, much smaller prompts.","acceptance_criteria":"Implementation prompts use reference format; Prompt size reduced by 50%+; Agent successfully uses Read tool for content; Token usage measurably decreased","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-10T06:46:52.220243-08:00","updated_at":"2025-12-10T14:26:33.955488-08:00","closed_at":"2025-12-10T14:26:33.955488-08:00","dependencies":[{"issue_id":"noface-t95","depends_on_id":"noface-s3n","type":"blocks","created_at":"2025-12-10T06:47:21.394847-08:00","created_by":"daemon"}],"comments":[{"id":7,"issue_id":"noface-t95","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/bm25.zig] read=[src/process.zig,src/state.zig] forbidden=[src/web.zig]","created_at":"2025-12-10T17:14:42Z"},{"id":16,"issue_id":"noface-t95","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/streaming.zig] read=[src/state.zig,src/monowiki.zig] forbidden=[]","created_at":"2025-12-10T20:40:30Z"},{"id":23,"issue_id":"noface-t95","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/bm25.zig] read=[src/state.zig,src/monowiki.zig,README.md] forbidden=[]","created_at":"2025-12-10T21:37:06Z"}]}
{"id":"noface-ukr","title":"Tracker access is scattered shell+jq pipelines","description":"Core orchestration (e.g., getNextIssue in src/loop.zig:356-414) shells out to 'bd ... | jq ...' strings for every query (ready, blocked, open count, show). There is no tracker abstraction or typed data model, so we repeat brittle pipelines, risk quoting bugs, and make dataflow hard to test/migrate (e.g., switching trackers). Introduce a beads client module that fetches/filters issues via a single JSON parser, surfaces typed structs/errors, and centralizes tracker selection so both CLI and worker paths share the same code.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T14:28:44.246892-08:00","updated_at":"2025-12-10T14:28:44.246892-08:00"}
{"id":"noface-v58","title":"Add HotFileStats tracking for lock contention","description":"Track per-file lock statistics to detect hot files:\n\nstruct HotFileStats {\n    lock_count: u32,\n    avg_wait_ms: u64,\n    queue_depth: u32,\n}\n\nUse this when scheduling to:\n- Force hot-file tasks into a serial lane\n- Suggest planner batch related issues touching hot files\n- Spawn meta-issues like 'split main.zig into modules'\n\nReference: [[parallel-execution]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:01:01.497899-08:00","updated_at":"2025-12-10T12:01:01.497899-08:00","labels":["locking","parallelism"],"comments":[{"id":30,"issue_id":"noface-v58","author":"femtomc","text":"MANIFEST: primary=[src/worker_pool.zig,src/state.zig,src/loop.zig] read=[src/process.zig,README.md] forbidden=[]","created_at":"2025-12-10T21:37:44Z"}]}
{"id":"noface-wcs","title":"Add manifest instrumentation (predicted vs actual files)","description":"Track manifest accuracy by logging:\n- manifest_files_predicted\n- files_actually_touched (from diff)\n\nCompute false positives (predicted but unused) and false negatives (needed but not declared).\n\nReference: [[manifests]] design doc","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-10T12:00:16.43084-08:00","updated_at":"2025-12-10T14:39:25.147033-08:00","labels":["instrumentation","manifests"],"comments":[{"id":20,"issue_id":"noface-wcs","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/state.zig] read=[src/worker_pool.zig,README.md] forbidden=[]","created_at":"2025-12-10T20:40:45Z"},{"id":27,"issue_id":"noface-wcs","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/state.zig,src/worker_pool.zig] read=[src/process.zig,README.md] forbidden=[]","created_at":"2025-12-10T21:37:28Z"}]}
{"id":"noface-x3k","title":"Add merge agent fallback after 3-way conflicts","description":"Implement the parallel-execution conflict policy step 3: when 3-way merge fails, spawn a merge agent with both diffs + base to propose a unified patch. Include manifest context, lock checks, and reuse test commands so we can accept the merged output automatically if it passes.","design":"parallel-execution","acceptance_criteria":"• When conflict detection + 3-way merge fail, orchestrator automatically invokes a merge agent with both diffs and base.\n• Merge agent output applies cleanly, respects manifest scope, and runs the configured build/tests before acceptance.\n• On merge-agent failure, system falls back to existing human/escalation path without losing either diff.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:19:50.190203-08:00","updated_at":"2025-12-10T12:19:50.190203-08:00"}
{"id":"noface-y93","title":"Write progress file updates when --progress-file is set","description":"--progress-file is parsed and mentioned in prompts, but noface never writes to the progress markdown itself. The design doc expects the flag to update the file so users can track runs automatically.","design":"README.md \u003e CLI Options (Output options)","acceptance_criteria":"- When progress_file is configured, each iteration appends/updates the markdown file with timestamp, issue id, status (completed/blocked), and short summary.\\n- Creates the file if missing; on write failure, log a warning and continue.\\n- Dry-run mode logs intent without writing; basic test covers progress writer logic.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-09T23:18:14.18455-08:00","updated_at":"2025-12-10T12:43:12.493803-08:00","comments":[{"id":6,"issue_id":"noface-y93","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig] read=[src/main.zig,src/markdown.zig] forbidden=[]","created_at":"2025-12-10T17:14:38Z"},{"id":15,"issue_id":"noface-y93","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig] read=[src/main.zig,src/config.zig] forbidden=[]","created_at":"2025-12-10T20:40:24Z"}]}
{"id":"noface-ye0","title":"Parse NEED_FILE / NEED_DOC signals from agent output","description":"Allow agents to request additional files mid-execution via structured signals:\n- NEED_FILE: src/auth.zig\n- NEED_DOC: design/auth.md\n\nWhen detected:\n1. Check locks (if file is free, acquire lock)\n2. Produce manifest v2 including the new file\n3. Re-prompt agent with expanded manifest and new file content\n4. If locked by another task, tell agent to proceed without or wait\n\nReference: [[manifests]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:00:21.646989-08:00","updated_at":"2025-12-10T12:00:21.646989-08:00","labels":["context","manifests"],"comments":[{"id":29,"issue_id":"noface-ye0","author":"femtomc","text":"MANIFEST: primary=[src/loop.zig,src/worker_pool.zig,src/state.zig,src/streaming.zig] read=[src/process.zig,README.md] forbidden=[]","created_at":"2025-12-10T21:37:39Z"}]}
{"id":"noface-ykf","title":"Implement 3-way merge fallback for conflicts","description":"Define a conflict resolution pipeline:\n\nStep 1: Detect\n- Two diffs touch overlapping hunks, or git apply fails\n\nStep 2: Auto-merge\n- Try 3-way merge (base, A, B)\n- If succeeds cleanly, run tests\n- If tests pass, accept merged result\n\nStep 3: LLM-assisted merge\n- Spawn a 'merge agent' with both diffs + conflicts\n- Ask it to produce a unified patch\n- Run tests again\n\nStep 4: Escalate\n- If merge agent fails or tests still fail\n- Escalate to human with both original diffs + explanation\n\nReference: [[parallel-execution]] design doc","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T12:01:09.057614-08:00","updated_at":"2025-12-10T12:01:09.057614-08:00","labels":["merging","parallelism"]}
{"id":"noface-yrc","title":"Persist manifests and batches across restarts","description":"State persistence in src/state.zig only writes metadata, worker status, bare issue status, and locks; manifests, pending/current batches, and attempt history are dropped. After a crash/restart the orchestrator loses manifest permissions and the parallel execution plan, so crash recovery cannot reconstruct locks or pending work. Serialize/deserialize manifests, batch queue/current batch, and last attempts in state.json and add tests to verify crash recovery preserves them safely.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-10T08:58:28.153084-08:00","updated_at":"2025-12-10T12:20:45.49019-08:00","comments":[{"id":1,"issue_id":"noface-yrc","author":"femtomc","text":"MANIFEST: primary=[src/state.zig] read=[src/loop.zig] forbidden=[]","created_at":"2025-12-10T17:14:15Z"}]}
{"id":"noface-zdk","title":"Validate config file and warn about issues","description":"Add config validation that warns users about:\n- Unknown keys in .noface.toml (typos)\n- Invalid values (negative intervals, empty commands)\n- Missing required tools before starting\n- Deprecated options\n\nPrint warnings at startup but don't fail unless critical.","acceptance_criteria":"- Startup validation warns on unknown keys with file/line context; typos do not block execution\n- Invalid values (negative intervals, empty commands) are rejected or warned with suggested fix; critical errors fail fast before run\n- Missing required tools/deprecated options are surfaced before planning/dispatch\n- Tests cover representative valid/invalid configs and warning output","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-09T23:00:14.783734-08:00","updated_at":"2025-12-10T12:43:13.12196-08:00","comments":[{"id":4,"issue_id":"noface-zdk","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,src/main.zig] read=[src/loop.zig,README.md] forbidden=[src/web.zig]","created_at":"2025-12-10T17:14:29Z"},{"id":13,"issue_id":"noface-zdk","author":"femtomc","text":"MANIFEST: primary=[src/config.zig,src/main.zig] read=[README.md,src/loop.zig] forbidden=[]","created_at":"2025-12-10T20:40:17Z"}]}
{"id":"noface-zqb","title":"Add per-pass metrics logging","description":"Log per-pass value metrics to make decisions data-driven.\n\nFor each pass type (planner, reviewer, quality), count:\n- How often it changes outcome\n  - Reviewer finds bug → implementation corrected\n  - Quality pass yields issues not caught otherwise\n\nTrack:\n- Average tokens / time per pass\n- Compute: 'Bugs caught per thousand tokens' or 'per minute'\n\nIf reviewer catches issues in 1/50 changes but costs a lot, restrict to riskier paths.\n\nReference: [[multi-pass]] design doc","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T12:02:41.784682-08:00","updated_at":"2025-12-10T12:02:41.784682-08:00","labels":["metrics","multi-pass"]}
